---
layout: single
title: "[ PROJECT ] 외주 프로젝트 로그인 인증 과정"
typora-root-url: ../
categories: [PROJECT]
tag: [인증]
author_profile: true # 연락처 정보 숨기기
search: true
---

![Authentication](/images/2024-09-10-wepublic-auth/Authentication.jpg)

이전 회사에서 진행했던 외주 프로젝트는 블록체인을 통해 DAO 플랫폼을 만드는 프로젝트였다. 이때 사용했던 로그인 비즈니스 로직과 인증에 사용된 주요 개념들을 복기해보고자 한다.

## 1. DAO 플랫폼 회원가입 및 로그인 과정

1. 플랫폼에서 회원가입과 로그인 버튼은 하나로 통일되어 있었다.

2. 로그인 버튼 클릭시 지갑앱 서비스를 제공했던 코인플러그라는 회사의 마이키핀(당시 이름) 서비스를 통해 QR코드 인증화면을 띄웠다.

   - 해당 지갑앱은 블록체인기반의 DID(분산신원인증) 앱이었는데, 탈중앙화 신원증명 기술을 사용하여 사용자가 DID를 통해 암호화된 신원정보를 공개하지 않고도 본인임을 증명할 수 있는 기술을 사용한다.

   - 이 지갑앱을 통해 DAO에 가입하면, 변조 불가능한 멤버십을 증명하는 NFT인 SBT(Soul Bound Token)가 발행된다.

   - 이 월렛에서 SBT를 조회하여 내가 가입한 DAO들의 목록을 확인할 수 있다.

3. 이 QR코드를 인증하면, 마이키핀 서버를 통해 로그인 시도한 유저의 DID, EOA, 개인정보를 받아올 수 있었다.
4. 이 데이터들을 사용하여 DB를 조회하여 회원가입과 로그인 처리를 진행하였다.

## 2. 회원가입 및 로그인 성공 시 인증 과정

1. 회원가입 및 로그인 성공시 반환값으로 JWT를 생성하여 발급해주었다. JWT를 생성하는 과정은 아래와 같다.
   1. 위에서 회원가입 및 로그인 성공시 반환받은 데이터들을 JSON으로 묶어 payload를 구성하였다.
   2. 양방향인 AES-256 암호화 알고리즘을 사용하는 암호화 함수를 직접 생성하였고, 문자열화한 payload를 이 암호화 함수에 인자로 넣어 암호화시켰다.
   3. NestJS의 JWT 라이브러리를 사용하여 암호화된 payload를 받아 JWT를 생성하였다. JWT를 서명하는데 비밀키를 생성하여 사용하였고, 보안을 강화하고자 토큰의 유효기간을 설정하였다.
      - 🚨 2번 단계를 진행하지 않고 그냥 payload를 사용하여 JWT를 생성할 경우, 누구라도 decode를 하면 payload를 확인할 수 있기 때문에 개인정보가 노출될 위험이 있었다. 때문에 payload를 강력한 암호화 알고리즘으로 알려진 AES-256 알고리즘으로 암호화시켰다. 이로 인해 누군가 JWT를 탈취해서 decode하더라도 암호화된 payload만을 확인할 수 있기에 보안을 높일 수 있었다. 이를 복호화하기 위해선, 같은 알고리즘 + 같은 비밀키 + 유효시간 내 확인 등 여러 장치를 통과해야 확인할 수 있기에 보안성이 높다고 판단하였다.
   4. 이렇게 클라이언트에서 로그인 요청하여 성공할 경우 백 서버는 JWT를 발급하여 반환해주었고, 이제 클라이언트는 회원 인증이 필요한 API 요청시에 이 JWT를 헤더에 담아 요청해야 했다.
   5. 서버 측에서는 해당 JWT를 복호화하여 개인정보를 추출할 수 있는 커스텀 Guard를 생성하여 논의된 API에 데코레이터로 호출하여 사용하였다.
