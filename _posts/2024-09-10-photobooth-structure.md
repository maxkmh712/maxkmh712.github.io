---
layout: single
title: "[ 프로젝트 회고 ] AI 포토부스 서비스 구조와 사용 기술"
typora-root-url: ../
categories: [📌 프로젝트 회고]
tag: [redis, AWS SQS]
author_profile: false # 연락처 정보 숨기기
sidebar: # 사이드바 네이게이션 수정
  # nav: "docs" # /_data/navigation.yml의 docs를 의미
  nav: "counts"
search: true
---

![real-photobooth](/images/2024-09-10-photobooth-structure/real-photobooth.png)

## 1. AI 포토부스 서비스 구조 분석

이전 회사에서 마지막으로 진행했던 프로젝트였던 만큼 애착이 가기도 했고 간단하지만 중요한 기술들이 꽤 쓰였던 프로젝트여서 구조를 복기하면서 사용했던 기술에 대해 다시 한 번 학습해보고자 한다. 먼저 비즈니스 로직은 다음과 같다.

1. 사용자가 포토부스에서 결제를 하면 프론트는 즉시 프록시 서버에 결제된 AI 필터 이미지 변환 `사전 요청`을 보낸다.
2. 프록시 서버는 필터에 맞는 EC2 인스턴스를 켜놓는다.
3. 사용자가 포토부스에서 이제 사진을 찍으면 프론트는 이 변환할 사진을 S3에 직접 업로드한다. 
4. 프론트는 1에서 보낸 `사전 요청`의 리턴값을 바탕으로 다시 프록시 서버에 AI 필터 이미지 변환 `본 요청`을 보낸다.
5. 그럼 프록시 서버는 이미지 변환 작업 목록을 필터별 SQS로 전송한다.
6. AI를 생성하는 제너레이터 서버는 각각 필터에 맞는 큐를 읽어서 이미지를 변환한다.
7. 제너레이터 서버는 이미지 변환을 완료하면 그 결과물을 S3에 업로드한다.
8. 또한 제너레이터는 이미지 변환을 완료한 사실을 redis를 통해 publish한다.
9. 프록시 서버는 redis의 특정 채널면 subscribe하여 메세지를 조회하여 완료된 사실을 인지한다.
10. 마지막으로 프록시 서버는 이미지 변환 결과값을 프론트에 전달한다. 



## 2. 주된 사용 기술 및 스택 ✍🏻

1. Proxy 서버로서의 AWS EC2
2. AWS SQS
3. AI 이미지 변환 제너레이터 서버로서의 AWS EC2
4. AWS S3
5. redis
